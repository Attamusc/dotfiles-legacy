#!/bin/sh
#
# Open a pull request using `hub`, put the url into the clipboard,
# and open the url in a browser.
#
# Usage:
# 
# $ git pr master
# # Pull request of {current_branch} created against master
#
# $ git pr master feature-some-cool-thing
# # Pull request of {current_branch} created against master

base=$1
head=$2

copy_and_open() {
  echo $1 | tr -d '\n' | pbcopy
  open $1
}

if [ -z "$base" ]; then
  echo "ERROR: A base branch is required."
  exit 0
fi

if [ -z "$head" ]; then
  echo "Creating pull request..."
  merge_url=`hub pull-request -b $base`
  echo "Created at '$merge_url'"

  copy_and_open $merge_url
else
  echo "Creating pull request..."
  merge_url=`hub pull-request -b $base -h $head`
  echo "Created at '$merge_url'"

  copy_and_open $merge_url
fi

